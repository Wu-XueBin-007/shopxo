(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user-order-comments/user-order-comments"],{"772f":function(t,a,e){"use strict";var i;e.d(a,"b",(function(){return n})),e.d(a,"c",(function(){return o})),e.d(a,"a",(function(){return i}));var n=function(){var t=this,a=t.$createElement;t._self._c},o=[]},7904:function(t,a,e){"use strict";var i=e("f504"),n=e.n(i);n.a},a524:function(t,a,e){"use strict";e.r(a);var i=e("772f"),n=e("e3e7");for(var o in n)"default"!==o&&function(t){e.d(a,t,(function(){return n[t]}))}(o);e("7904");var s,l=e("f0c5"),r=Object(l["a"])(n["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],s);a["default"]=r.exports},e3e7:function(t,a,e){"use strict";e.r(a);var i=e("e882"),n=e.n(i);for(var o in i)"default"!==o&&function(t){e.d(a,t,(function(){return i[t]}))}(o);a["default"]=n.a},e603:function(t,a,e){"use strict";(function(t){e("7abb");i(e("66fd"));var a=i(e("a524"));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=e,t(a.default)}).call(this,e("543d")["createPage"])},e882:function(t,a,e){"use strict";(function(t){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var i=getApp(),n=function(){e.e("components/no-data/no-data").then(function(){return resolve(e("126b"))}.bind(null,e)).catch(e.oe)},o=function(){e.e("components/bottom-line/bottom-line").then(function(){return resolve(e("e5fd"))}.bind(null,e)).catch(e.oe)},s=i.globalData.get_static_url("common"),l={data:function(){return{common_static_url:s,data_list_loding_status:1,data_list_loding_msg:"",params:null,detail:null,editor_path_type:"",rating_msg:["非常差","差","一般","好","非常好"],anonymous_value:0,anonymous_msg_list:["你写的评论会以匿名的形式展现","你写的评论会以昵称的形式展现"],form_rating_list:[],form_images_list:[],form_content_list:[],form_button_disabled:!1}},components:{componentNoData:n,componentBottomLine:o},props:{},onLoad:function(t){this.setData({params:t})},onShow:function(){this.init(),i.globalData.show_share_menu()},onPullDownRefresh:function(){this.init()},methods:{init:function(){var a=this;t.showLoading({title:"加载中..."}),this.setData({data_list_loding_status:1}),t.request({url:i.globalData.get_request_url("comments","order"),method:"POST",data:{id:this.params.id},dataType:"json",success:function(e){if(t.hideLoading(),t.stopPullDownRefresh(),0==e.data.code){var n=e.data.data;a.setData({editor_path_type:n.editor_path_type||"",detail:n.data,data_list_loding_status:3,data_list_loding_msg:""})}else a.setData({data_list_loding_status:2,data_list_loding_msg:e.data.msg}),i.globalData.is_login_check(e.data,a,"init")&&i.globalData.showToast(e.data.msg)},fail:function(){t.hideLoading(),t.stopPullDownRefresh(),a.setData({data_list_loding_status:2,data_list_loding_msg:"服务器请求出错"}),i.globalData.showToast("服务器请求出错")}})},upload_show_event:function(a){var e=a.currentTarget.dataset.index,i=a.currentTarget.dataset.ix;t.previewImage({current:this.form_images_list[e][i],urls:this.form_images_list[e]})},upload_delete_event:function(a){var e=a.currentTarget.dataset.index,i=a.currentTarget.dataset.ix,n=this;t.showModal({title:"温馨提示",content:"删除后不可恢复、继续吗？",success:function(t){if(t.confirm){var a=n.form_images_list;a[e].splice(i,1),n.setData({form_images_list:a})}}})},file_upload_event:function(a){for(var e=a.currentTarget.dataset.index,i=this.form_images_list,n=this.detail.items.length,o=0;o<n;o++)void 0==i[o]&&(i[o]=[]);this.setData({form_images_list:i});var s=this;t.chooseImage({count:3,success:function(t){var a=0,i=0,n=t.tempFilePaths.length,o=0;s.upload_one_by_one(e,t.tempFilePaths,a,i,o,n)}})},upload_one_by_one:function(a,e,n,o,s,l){var r=this;(null==(r.form_images_list[a]||null)||r.form_images_list[a].length<3)&&t.uploadFile({url:i.globalData.get_request_url("index","ueditor"),filePath:e[s],name:"upfile",formData:{action:"uploadimage",path_type:r.editor_path_type},success:function(t){if(n++,200==t.statusCode){var e="object"==typeof t.data?t.data:JSON.parse(t.data);if(0==e.code&&null!=(e.data.url||null)){var o=r.form_images_list;null==(o[a]||null)&&(o[a]=[]),o[a].push(e.data.url),r.setData({form_images_list:o})}else i.globalData.showToast(e.msg)}},fail:function(t){o++},complete:function(t){s++,s>=l||r.upload_one_by_one(a,e,n,o,s,l)}})},anonymous_event:function(t){this.setData({anonymous_value:1==t.detail.value?1:0})},rating_event:function(t){for(var a=t.currentTarget.dataset.index,e=t.currentTarget.dataset.value,i=this.form_rating_list,n=this.detail.items.length,o=0;o<n;o++)void 0==i[o]&&(i[o]=0),a==o&&(i[o]=e);this.setData({form_rating_list:i})},form_content_event:function(t){for(var a=t.currentTarget.dataset.index,e=t.detail.value,i=this.form_content_list,n=this.detail.items.length,o=0;o<n;o++)void 0==i[o]&&(i[o]=""),a==o&&(i[o]=e);this.setData({form_content_list:i})},formSubmit:function(a){var e=this.detail.items.length,n=this.form_rating_list.length;if(n<e)return i.globalData.showToast("请先评分"),!1;var o=Math.max.apply(null,this.form_rating_list),s=Math.min.apply(null,this.form_rating_list);if(s<1||o>5)return i.globalData.showToast("还有未评分"),!1;n=this.form_content_list.length;if(n<e)return i.globalData.showToast("请填写评论内容"),!1;for(var l in this.form_content_list){n=this.form_content_list[l].length;if(n<6||n>230)return i.globalData.showToast("评论内容 6~230 个字符之间"),!1}if(this.form_images_list.length>0)for(var l in this.form_images_list)if(this.form_images_list[l].length>3)return i.globalData.showToast("每项评论图片不能超过3张"),!1;var r=a.detail.value;r["is_anonymous"]=1==r["is_anonymous"]?1:0,r["id"]=this.detail.id,r["goods_id"]=JSON.stringify(this.detail.items.map((function(t){return t.goods_id}))),r["rating"]=JSON.stringify(this.form_rating_list),r["content"]=JSON.stringify(this.form_content_list),r["images"]=this.form_images_list.length>0?JSON.stringify(this.form_images_list):"";var u=this;t.showLoading({title:"处理中..."}),u.setData({form_button_disabled:!0}),t.request({url:i.globalData.get_request_url("commentssave","order"),method:"POST",data:r,dataType:"json",success:function(a){t.hideLoading(),0==a.data.code?(i.globalData.showToast(a.data.msg,"success"),setTimeout((function(){t.navigateBack()}),2e3)):(u.setData({form_button_disabled:!1}),i.globalData.showToast(a.data.msg))},fail:function(){t.hideLoading(),u.setData({form_button_disabled:!1}),i.globalData.showToast("服务器请求出错")}})}}};a.default=l}).call(this,e("543d")["default"])},f504:function(t,a,e){}},[["e603","common/runtime","common/vendor"]]]);