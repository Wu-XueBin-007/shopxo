(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/cart/cart"],{"553c":function(t,a,e){"use strict";(function(t){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var o=getApp(),n=function(){e.e("components/quick-nav/quick-nav").then(function(){return resolve(e("3783"))}.bind(null,e)).catch(e.oe)},s=function(){e.e("components/no-data/no-data").then(function(){return resolve(e("126b"))}.bind(null,e)).catch(e.oe)},i=o.globalData.get_static_url("common"),l={data:function(){return{common_static_url:i,data_list_loding_status:1,data_list_loding_msg:"",data_bottom_line_status:!1,data_list:[],total_price:"0.00",is_selected_all:!1,already_selected_status:!1,currency_symbol:o.globalData.data.currency_symbol,common_site_type:0,common_is_exhibition_mode_btn_text:null,common_app_customer_service_tel:null,swipe_item_index:null,swipe_options:[{text:"收藏",style:{backgroundColor:"#1AAD19"}},{text:"删除",style:{backgroundColor:"#E64340"}}]}},components:{componentQuickNav:n,componentNoData:s},props:{},onShow:function(){this.init(),this.init_config()},onPullDownRefresh:function(){this.init()},methods:{init_config:function(t){1==(t||!1)?this.setData({currency_symbol:o.globalData.get_config("currency_symbol"),common_site_type:o.globalData.get_config("config.common_site_type"),common_is_exhibition_mode_btn_text:o.globalData.get_config("config.common_is_exhibition_mode_btn_text","立即咨询"),common_app_customer_service_tel:o.globalData.get_config("config.common_app_customer_service_tel")}):o.globalData.is_config(this,"init_config")},init:function(a){var e=this,n=o.globalData.get_user_info(this,"init");0!=n?o.globalData.user_is_need_login(n)?(t.stopPullDownRefresh(),t.showModal({title:"温馨提示",content:"绑定手机号码",confirmText:"确认",cancelText:"暂不",success:function(a){a.confirm?t.navigateTo({url:"/pages/login/login?event_callback=init"}):e.setData({data_list_loding_status:0,data_bottom_line_status:!1,data_list_loding_msg:"请绑定手机号码"})}}),o.globalData.show_share_menu()):this.get_data():(t.stopPullDownRefresh(),this.setData({data_list_loding_status:0,data_bottom_line_status:!1,data_list_loding_msg:"请先授权用户信息"}),o.globalData.show_share_menu())},get_data:function(){var a=this;this.setData({data_list_loding_status:1,total_price:"0.00",is_selected_all:!1,already_selected_status:!1}),t.request({url:o.globalData.get_request_url("index","cart"),method:"POST",data:{},dataType:"json",success:function(e){if(t.stopPullDownRefresh(),0==e.data.code){var n=e.data.data;a.setData({data_list:n.data,data_list_loding_status:0==n.data.length?0:3,data_bottom_line_status:!0,data_list_loding_msg:"购物车空空如也"});var s=n.common_cart_total||0;s<=0?o.globalData.set_tab_bar_badge(2,0):o.globalData.set_tab_bar_badge(2,1,s)}else a.setData({data_list_loding_status:2,data_bottom_line_status:!1,data_list_loding_msg:e.data.msg}),o.globalData.is_login_check(e.data,a,"get_data")&&o.globalData.showToast(e.data.msg);setTimeout((function(){o.globalData.show_share_menu()}),1e3)},fail:function(){t.stopPullDownRefresh(),a.setData({data_list_loding_status:2,data_bottom_line_status:!1,data_list_loding_msg:"服务器请求出错"}),o.globalData.showToast("服务器请求出错")}})},goods_buy_number_blur:function(t){var a=t.currentTarget.dataset.index||0,e=parseInt(t.detail.value)||1;this.goods_buy_number_func(a,e)},goods_buy_number_event:function(t){var a=t.currentTarget.dataset.index||0,e=parseInt(t.currentTarget.dataset.type)||0,o=parseInt(this.data_list[a]["stock"]),n=0==e?o-1:o+1;this.goods_buy_number_func(a,n)},goods_buy_number_func:function(a,e){var n=this,s=this.data_list,i=parseInt(s[a]["buy_min_number"])||1,l=parseInt(s[a]["buy_max_number"])||0,_=parseInt(s[a]["inventory"]),c=s[a]["inventory_unit"];return e<i&&(e=i,i>1)?(o.globalData.showToast("起购"+i+c),!1):l>0&&e>l?(e=l,o.globalData.showToast("限购"+l+c),!1):e>_?(e=_,o.globalData.showToast("库存数量"+_+c),!1):(1!=s[a]["stock"]||1!=e)&&(t.showLoading({title:"处理中...",mask:!0}),void t.request({url:o.globalData.get_request_url("stock","cart"),method:"POST",data:{id:s[a]["id"],goods_id:s[a]["goods_id"],stock:e},dataType:"json",success:function(e){if(t.hideLoading(),0==e.data.code){var i=e.data.data;s[a]["stock"]=i.stock,s[a]["original_price"]=i.original_price,s[a]["price"]=i.price,n.setData({data_list:s}),n.selected_calculate()}else o.globalData.is_login_check(e.data)?o.globalData.showToast(e.data.msg):o.globalData.showToast("提交失败，请重试！")},fail:function(){t.hideLoading(),o.globalData.showToast("服务器请求出错")}}))},goods_favor_delete:function(a,e,n){var s=this;t.request({url:o.globalData.get_request_url("favor","goods"),method:"POST",data:{id:e,is_mandatory_favor:1},dataType:"json",success:function(t){0==t.data.code?s.cart_delete(a,n):o.globalData.is_login_check(t.data)?o.globalData.showToast(t.data.msg):o.globalData.showToast("提交失败，请重试！")},fail:function(){o.globalData.showToast("服务器请求出错")}})},cart_all_remove_event:function(a){var e=this;t.showModal({title:"温馨提示",content:"挑了这么久，真的要删除吗",confirmText:"确认",cancelText:"暂不",success:function(t){if(t.confirm){var a=[],n=e.data_list||[];for(var s in n)1==(n[s]["selected"]||!1)&&a.push(n[s]["id"]);if(a.length<=0)return o.globalData.showToast("请先选择数据"),!1;e.cart_delete(a.join(","),"delete")}}})},swipe_change:function(t,a){this.setData({swipe_item_index:"none"==t?null:a})},swipe_opt_event:function(t){var a=t.index||0,e=this.data_list;if(null===this.swipe_item_index)return o.globalData.showToast("请先滑动要操作的数据"),!1;if(null==(e[this.swipe_item_index]||null))return o.globalData.showToast("数据不存在"),!1;var n=e[this.swipe_item_index]["id"];if(0==a){var s=e[this.swipe_item_index]["goods_id"];this.goods_favor_delete(n,s,"favor")}else this.cart_delete(n,"delete")},cart_delete:function(a,e){var n=this;t.request({url:o.globalData.get_request_url("delete","cart"),method:"POST",data:{id:a},dataType:"json",success:function(t){if(0==t.data.code){var s=[],i=a.split(","),l=n.data_list;for(var _ in l)-1==i.indexOf(l[_]["id"])&&s.push(l[_]);n.setData({data_list:s,data_list_loding_status:0==s.length?0:n.data_list_loding_status});var c=t.data.data||0;c<=0?o.globalData.set_tab_bar_badge(2,0):o.globalData.set_tab_bar_badge(2,1,c),o.globalData.showToast("delete"==e?"删除成功":"收藏成功","success")}else o.globalData.is_login_check(t.data)?o.globalData.showToast("delete"==e?"删除失败":"收藏失败"):o.globalData.showToast("提交失败，请重试！")},fail:function(){o.globalData.showToast("服务器请求出错")}})},selected_event:function(t){var a=t.currentTarget.dataset.type||null;if(null!=a){var e=this.data_list,o=this.is_selected_all;switch(a){case"all":for(var n in o=1!=o,e)1!=e[n]["is_error"]&&(e[n]["selected"]=o);break;case"node":var s=t.currentTarget.dataset.index||0;1!=e[s]["is_error"]&&(e[s]["selected"]=1!=e[s]["selected"]);break}this.setData({data_list:e,is_selected_all:o}),this.selected_calculate()}},selected_calculate:function(){var t=0,a=0,e=0,o=this.data_list;for(var n in o)0==(o[n]["is_error"]||0)&&a++,1==(o[n]["selected"]||!1)&&(t+=o[n]["stock"]*o[n]["price"],e++);this.setData({total_price:t.toFixed(2),already_selected_status:e>0,is_selected_all:e>0&&e>=a})},buy_submit_event:function(a){var e=0,n=[],s=this.data_list||[];for(var i in s)1==(s[i]["selected"]||!1)&&(n.push(s[i]["id"]),e++);if(e<=0)return o.globalData.showToast("请选择商品"),!1;var l={buy_type:"cart",ids:n.join(",")};t.navigateTo({url:"/pages/buy/buy?data="+encodeURIComponent(JSON.stringify(l))})},exhibition_submit_event:function(t){o.globalData.call_tel(this.common_app_customer_service_tel)}}};a.default=l}).call(this,e("543d")["default"])},"58ef":function(t,a,e){"use strict";var o=e("e69f"),n=e.n(o);n.a},"72f3":function(t,a,e){"use strict";e.r(a);var o=e("553c"),n=e.n(o);for(var s in o)"default"!==s&&function(t){e.d(a,t,(function(){return o[t]}))}(s);a["default"]=n.a},a6d7:function(t,a,e){"use strict";(function(t){e("7abb");o(e("66fd"));var a=o(e("cb96"));function o(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=e,t(a.default)}).call(this,e("543d")["createPage"])},cb96:function(t,a,e){"use strict";e.r(a);var o=e("ee87"),n=e("72f3");for(var s in n)"default"!==s&&function(t){e.d(a,t,(function(){return n[t]}))}(s);e("58ef");var i,l=e("f0c5"),_=Object(l["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],i);a["default"]=_.exports},e69f:function(t,a,e){},ee87:function(t,a,e){"use strict";e.d(a,"b",(function(){return n})),e.d(a,"c",(function(){return s})),e.d(a,"a",(function(){return o}));var o={uniSwipeAction:function(){return e.e("uni_modules/uni-swipe-action/components/uni-swipe-action/uni-swipe-action").then(e.bind(null,"b6b3"))},uniSwipeActionItem:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uni-swipe-action/components/uni-swipe-action-item/uni-swipe-action-item")]).then(e.bind(null,"7350"))},uniIcons:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(e.bind(null,"1d00"))}},n=function(){var t=this,a=t.$createElement;t._self._c},s=[]}},[["a6d7","common/runtime","common/vendor"]]]);