(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{"0f1c":function(e,t,i){"use strict";i.r(t);var a=i("d4b4"),_=i("102f");for(var n in _)"default"!==n&&function(e){i.d(t,e,(function(){return _[e]}))}(n);i("a5d0");var r,s=i("f0c5"),o=Object(s["a"])(_["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],r);t["default"]=o.exports},"102f":function(e,t,i){"use strict";i.r(t);var a=i("3423"),_=i.n(a);for(var n in a)"default"!==n&&function(e){i.d(t,e,(function(){return a[e]}))}(n);t["default"]=_.a},3423:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=_(i("7d64"));function _(e){return e&&e.__esModule?e:{default:e}}var n=getApp(),r=function(){i.e("components/popup/popup").then(function(){return resolve(i("b1e3"))}.bind(null,i)).catch(i.oe)},s={data:function(){return{params:null,user:null,form_input_mobile_value:"",form_input_email_value:"",form_input_accounts_value:"",form_input_image_verify_value:"",verify_submit_text:"获取验证码",verify_loading:!1,verify_disabled:!1,form_submit_loading:!1,verify_time_total:60,temp_clear_time:null,agreement_status:!1,verify_image_url:null,popup_image_verify_status:!1,common_user_is_onekey_bind_mobile:0,home_site_logo_square:null,home_user_login_type:[],home_user_reg_type:[],home_user_login_img_verify_state:0,home_user_register_img_verify_state:0,common_img_verify_state:0,current_login_bind_type:0,current_opt_form:"auth",current_opt_type:"auth",current_opt_type_title:{auth:"授权用户信息",bind:"绑定手机",login_username:"账号密码登录",login_sms:"手机验证码登录",login_email:"邮箱验证码登录",reg_username:"账号密码注册",reg_sms:"手机验证码注册",reg_email:"邮箱验证码注册",forget:"密码找回",success:"登录成功"},plugins_thirdpartylogin_data:null,plugins_thirdpartylogin_user:null,error_msg:null}},components:{componentPopup:r},props:{},onLoad:function(t){if(this.setData({params:t}),null!=(t.msg||null)){var i=a.default.decode(decodeURIComponent(t.msg));this.setData({error_msg:i})}if(null!=(t.thirdpartylogin||null)){var _=JSON.parse(a.default.decode(decodeURIComponent(t.thirdpartylogin)));this.setData({plugins_thirdpartylogin_user:_}),1!=(_.is_force_bind_user||0)&&e.setStorageSync(n.globalData.data.cache_user_info_key,_)}this.init()},onShow:function(){this.init_config(),n.globalData.show_share_menu()},methods:{init:function(){this.init_config(!0);var t=n.globalData.get_user_cache_info()||null,i=null==t?"auth":"bind",a=i;e.setNavigationBarTitle({title:this.current_opt_type_title[i]}),this.setData({user:t,current_opt_type:i,current_opt_form:a})},init_config:function(e){1==(e||!1)?this.setData({common_user_is_onekey_bind_mobile:n.globalData.get_config("config.common_user_is_onekey_bind_mobile"),home_site_logo_square:n.globalData.get_config("config.home_site_logo_square"),home_user_login_type:n.globalData.get_config("config.home_user_login_type"),home_user_reg_type:n.globalData.get_config("config.home_user_reg_type"),home_user_login_img_verify_state:n.globalData.get_config("config.home_user_login_img_verify_state"),home_user_register_img_verify_state:n.globalData.get_config("config.home_user_register_img_verify_state"),common_img_verify_state:n.globalData.get_config("config.common_img_verify_state"),plugins_thirdpartylogin_config:n.globalData.get_config("plugins_base.thirdpartylogin.data"),plugins_thirdpartylogin_data:n.globalData.get_config("plugins_thirdpartylogin_data")}):n.globalData.is_config(this,"init_config")},get_user_info_event:function(t){var i=this;if(!this.agreement_status)return n.globalData.showToast("请先同意协议"),!1;e.getUserProfile({desc:"用于完善会员资料",lang:"zh_CN",success:function(e){i.user_auth_code(e.userInfo)}})},user_auth_code:function(e){null!=(e||null)?n.globalData.user_auth_login(this,"user_auth_back_event",e):n.globalData.showToast("授权失败")},user_auth_back_event:function(){var t=n.globalData.get_user_cache_info();this.setData({user:t||null}),0==n.globalData.user_is_need_login(t)&&e.navigateBack(),this.init()},form_input_mobile_event:function(e){this.setData({form_input_mobile_value:e.detail.value})},form_input_email_event:function(e){this.setData({form_input_email_value:e.detail.value})},form_input_accounts_event:function(e){this.setData({form_input_accounts_value:e.detail.value})},form_input_image_verify_event:function(e){this.setData({form_input_image_verify_value:e.detail.value})},popup_image_verify_close_event:function(e){this.setData({popup_image_verify_status:!1})},popup_image_verify_submit_event:function(e){this.verify_send_handle()},verify_send_event:function(){return"login_sms"!=this.current_opt_type&&"reg_sms"!=this.current_opt_type&&"bind"!=this.current_opt_type||null!=(this.form_input_mobile_value||null)?"login_email"!=this.current_opt_type&&"reg_email"!=this.current_opt_type||null!=(this.form_input_email_value||null)?"forget"==this.current_opt_type&&null==(this.form_input_accounts_value||null)?(n.globalData.showToast("请填写手机或邮箱"),!1):"bind"!=this.current_opt_form&&"bind_verify"!=this.current_opt_form&&1==this.common_img_verify_state?(this.setData({popup_image_verify_status:!0}),!1):void this.verify_send_handle():(n.globalData.showToast("请填写电子邮箱"),!1):(n.globalData.showToast("请填写手机号码"),!1)},verify_send_handle:function(){var t=this;if("bind"!=this.current_opt_form&&"bind_verify"!=this.current_opt_form&&1==this.common_img_verify_state&&(null==(this.form_input_image_verify_value||null)||this.form_input_image_verify_value.length<4))return n.globalData.showToast("请输入有效验证码"),!1;var i="",a="";if("bind"==this.current_opt_form||"bind_verify"==this.current_opt_form){i="appmobilebindverifysend",a="user_bind";var _={mobile:this.form_input_mobile_value||""}}else{"login"==this.current_opt_form?(i="loginverifysend",a="user_login"):"reg"==this.current_opt_form?(i="regverifysend",a="user_reg"):"forget"==this.current_opt_form&&(i="forgetpwdverifysend",a="user_forget");var r="bind_verify"==this.current_opt_type||"login_sms"==this.current_opt_type||"reg_sms"==this.current_opt_type?this.form_input_mobile_value:"forget"==this.current_opt_type?this.form_input_accounts_value:this.form_input_email_value;_={accounts:r,verify:this.form_input_image_verify_value,type:this.current_opt_type.replace("login_","").replace("reg_","")}}var s=this;e.showLoading({title:"发送中..."}),this.setData({verify_submit_text:"发送中",verify_loading:!0,verify_disabled:!0}),e.request({url:n.globalData.get_request_url(i,"user"),method:"POST",data:_,dataType:"json",success:function(i){if(e.hideLoading(),0==i.data.code){1==t.common_img_verify_state&&t.setData({popup_image_verify_status:!1}),t.setData({verify_loading:!1});var _=t.verify_time_total;t.temp_clear_time=setInterval((function(){_<=1?(clearInterval(s.temp_clear_time),s.setData({verify_submit_text:"获取验证码",verify_disabled:!1})):(_--,s.setData({verify_submit_text:"剩余 "+_+" 秒"}))}),1e3)}else t.setData({verify_submit_text:"获取验证码",verify_loading:!1,verify_disabled:!1,form_input_image_verify_value:""}),t.image_verify_event(a),n.globalData.showToast(i.data.msg)},fail:function(){e.hideLoading(),t.setData({verify_submit_text:"获取验证码",verify_loading:!1,verify_disabled:!1,form_input_image_verify_value:""}),t.image_verify_event(a),n.globalData.showToast("服务器请求出错")}})},formBind:function(t){var i=this,a=n.globalData.get_launch_cache_info(),_=n.globalData.application_client_type(),r=_+"_openid",s=_+"_unionid";t.detail.value[r]=this.user[r]||"",t.detail.value[s]=this.user[s]||"",t.detail.value["nickname"]=this.user.nickname,t.detail.value["avatar"]=this.user.avatar,t.detail.value["province"]=this.user.province,t.detail.value["city"]=this.user.city,t.detail.value["gender"]=this.user.gender,t.detail.value["referrer"]=null==a?null==(this.user||null)?0:this.user.referrer||0:a.referrer||0;var o=[{fields:"mobile",msg:"请填写手机号码"},{fields:"verify",msg:"请填写验证码"}];o.push({fields:r,msg:"授权id不能为空"}),n.globalData.fields_check(t.detail.value,o)&&(e.showLoading({title:"处理中..."}),this.setData({form_submit_loading:!0}),e.request({url:n.globalData.get_request_url("appmobilebind","user"),method:"POST",data:t.detail.value,dataType:"json",success:function(e){i.user_success_handle(e)},fail:function(){e.hideLoading(),i.setData({form_submit_loading:!1}),n.globalData.showToast("服务器请求出错")}}))},confirm_phone_number_event:function(t){var i=this,a=t.detail.encryptedData||null,_=t.detail.iv||null;if(null!=a&&null!=_){var r=n.globalData.get_launch_cache_info(),s=null==r?null==(this.user||null)?0:this.user.referrer||0:r.referrer||0,o=n.globalData.application_client_type(),l=o+"_openid",u=o+"_unionid",g={encrypted_data:a,iv:_,openid:this.user[l]||"",nickname:this.user.nickname||"",avatar:this.user.avatar||"",province:this.user.province||"",city:this.user.city||"",gender:this.user.gender||0,referrer:s};g[u]=this.user[u]||"",e.showLoading({title:"处理中..."});var c=this;e.request({url:n.globalData.get_request_url("onekeyusermobilebind","user"),method:"POST",data:g,dataType:"json",success:function(e){i.user_success_handle(e)},fail:function(){e.hideLoading(),c.showToast("服务器请求出错")}})}},formLogin:function(t){var i=this;if(!this.agreement_status)return n.globalData.showToast("请先同意协议"),!1;var a=[];if("login_sms"==this.current_opt_type&&a.push({fields:"accounts",msg:"请输入手机号码"}),"login_email"==this.current_opt_type&&a.push({fields:"accounts",msg:"请输入电子邮箱"}),"login_username"==this.current_opt_type&&(a.push({fields:"accounts",msg:"请输入账号"}),a.push({fields:"pwd",msg:"请输入密码"})),("login_sms"==this.current_opt_type||"login_email"==this.current_opt_type||"login_username"==this.current_opt_type&&1==this.home_user_login_img_verify_state)&&a.push({fields:"verify",msg:"请输入验证码"}),n.globalData.fields_check(t.detail.value,a)){t.detail.value["type"]=this.current_opt_type.replace("login_","");var _=n.globalData.application_client_type();if(null!=(this.user||null)){var r=_+"_openid",s=_+"_unionid";t.detail.value[r]=this.user[r]||"",t.detail.value[s]=this.user[s]||""}else{var o=n.globalData.get_login_cache_info();if(null!=o){r=_+"_openid",s=_+"_unionid";t.detail.value[r]=o["openid"]||"",t.detail.value[s]=o["unionid"]||""}}e.showLoading({title:"登录中..."}),this.setData({form_submit_loading:!0}),e.request({url:n.globalData.get_request_url("login","user"),method:"POST",data:t.detail.value,dataType:"json",success:function(e){i.user_success_handle(e)},fail:function(){e.hideLoading(),i.setData({form_submit_loading:!1}),n.globalData.showToast("服务器请求出错")}})}},formReg:function(t){var i=this;if(!this.agreement_status)return n.globalData.showToast("请先同意协议"),!1;var a=[];if("reg_sms"==this.current_opt_type&&a.push({fields:"accounts",msg:"请输入手机号码"}),"reg_email"==this.current_opt_type&&a.push({fields:"accounts",msg:"请输入电子邮箱"}),"reg_username"==this.current_opt_type&&(a.push({fields:"accounts",msg:"请输入账号"}),a.push({fields:"pwd",msg:"请输入密码"})),("reg_sms"==this.current_opt_type||"reg_email"==this.current_opt_type||"reg_username"==this.current_opt_type&&1==this.home_user_register_img_verify_state)&&a.push({fields:"verify",msg:"请输入验证码"}),n.globalData.fields_check(t.detail.value,a)){t.detail.value["type"]=this.current_opt_type.replace("reg_","");var _=n.globalData.application_client_type();if(null!=(this.user||null)){var r=_+"_openid",s=_+"_unionid";t.detail.value[r]=this.user[r]||"",t.detail.value[s]=this.user[s]||"",t.detail.value["nickname"]=this.user.nickname,t.detail.value["avatar"]=this.user.avatar,t.detail.value["province"]=this.user.province,t.detail.value["city"]=this.user.city,t.detail.value["gender"]=this.user.gender}else{var o=n.globalData.get_login_cache_info();if(null!=o){r=_+"_openid",s=_+"_unionid";t.detail.value[r]=o["openid"]||"",t.detail.value[s]=o["unionid"]||""}}var l=n.globalData.get_launch_cache_info();t.detail.value["referrer"]=null==l?null==(this.user||null)?0:this.user.referrer||0:l.referrer||0,e.showLoading({title:"注册中..."}),this.setData({form_submit_loading:!0}),e.request({url:n.globalData.get_request_url("reg","user"),method:"POST",data:t.detail.value,dataType:"json",success:function(e){i.user_success_handle(e)},fail:function(){e.hideLoading(),i.setData({form_submit_loading:!1}),n.globalData.showToast("服务器请求出错")}})}},formForget:function(t){var i=this,a=[{fields:"accounts",msg:"请输入手机或邮箱"},{fields:"verify",msg:"请输入验证码"},{fields:"pwd",msg:"请设置密码"}];n.globalData.fields_check(t.detail.value,a)&&(e.showLoading({title:"处理中..."}),this.setData({form_submit_loading:!0}),e.request({url:n.globalData.get_request_url("forgetpwd","user"),method:"POST",data:t.detail.value,dataType:"json",success:function(t){if(e.hideLoading(),0==t.data.code){n.globalData.showToast(t.data.msg,"success");var a=i;setTimeout((function(){var e=null!=(a.home_user_login_type||null)&&a.home_user_login_type.length>0?"login_"+a.home_user_login_type[0]:null;a.setData({form_submit_loading:!1,current_opt_form:"login",current_opt_type:e}),null!=e&&(1!=a.home_user_login_img_verify_state&&1!=a.common_img_verify_state||a.image_verify_event("user_login"))}),3e3)}else i.setData({form_submit_loading:!1}),n.globalData.showToast(t.data.msg)},fail:function(){e.hideLoading(),i.setData({form_submit_loading:!1}),n.globalData.showToast("服务器请求出错")}}))},user_success_handle:function(t){var i=this;0==t.data.code&&null!=(t.data.data||null)?(clearInterval(this.temp_clear_time),e.setStorageSync(n.globalData.data.cache_user_info_key,t.data.data),null!=(this.plugins_thirdpartylogin_user||null)&&1==(this.plugins_thirdpartylogin_user.is_force_bind_user||0)?e.request({url:n.globalData.get_request_url("bind","index","thirdpartylogin"),method:"POST",data:this.plugins_thirdpartylogin_user,dataType:"json",success:function(t){0==t.data.code?(e.hideLoading(),e.setStorageSync(n.globalData.data.cache_user_info_key,t.data.data),i.success_back_handle(t)):(e.hideLoading(),i.setData({form_submit_loading:!1}),n.globalData.showToast(t.data.msg))},fail:function(){e.hideLoading(),i.setData({form_submit_loading:!1}),n.globalData.showToast("服务器请求出错")}}):(e.hideLoading(),this.success_back_handle(t))):(e.hideLoading(),this.setData({form_submit_loading:!1}),n.globalData.showToast(t.data.msg))},success_back_handle:function(t){n.globalData.showToast(t.data.msg,"success");var i=this.params.event_callback||null;setTimeout((function(){if(null!=i){var t=getCurrentPages();null!=(t[t.length-2][i]||null)&&t[t.length-2][i]()}e.navigateBack()}),1e3)},agreement_event:function(e){var t=e.currentTarget.dataset.value||null;if(null==t)return n.globalData.showToast("协议类型有误"),!1;var i="agreement_"+t+"_url",a=n.globalData.get_config("config."+i)||null;if(null==a)return n.globalData.showToast("协议url地址有误"),!1;n.globalData.open_web_view(a)},agreement_change:function(e){this.setData({agreement_status:!this.agreement_status})},opt_form_event:function(t){var i=t.currentTarget.dataset.value,a={current_opt_form:i};"auth"!=i&&"bind"!=i||(a["current_opt_type"]=i),"forget"==i&&(a["current_opt_type"]="forget",1==this.common_img_verify_state&&this.image_verify_event("user_forget")),"login"==i&&this.home_user_login_type.length>0&&(a["current_opt_type"]="login_"+this.home_user_login_type[0],1!=this.home_user_login_img_verify_state&&1!=this.common_img_verify_state||this.image_verify_event("user_login")),"reg"==i&&this.home_user_reg_type.length>0&&(a["current_opt_type"]="reg_"+this.home_user_reg_type[0],1!=this.home_user_register_img_verify_state&&1!=this.common_img_verify_state||this.image_verify_event("user_reg")),this.setData(a),null!=(a.current_opt_type||null)&&e.setNavigationBarTitle({title:this.current_opt_type_title[a.current_opt_type]})},opt_type_event:function(t){var i=t.currentTarget.dataset.value||null;null!=i&&(this.setData({current_opt_type:i}),"login_username"==i&&1==this.home_user_login_img_verify_state&&this.image_verify_event("user_login"),"login_sms"!=i&&"login_email"!=i||1!=this.common_img_verify_state||this.image_verify_event("user_login"),"reg_username"==i&&1==this.home_user_register_img_verify_state&&this.image_verify_event("user_reg"),"reg_sms"!=i&&"reg_email"!=i||1!=this.common_img_verify_state||this.image_verify_event("user_reg"),e.setNavigationBarTitle({title:this.current_opt_type_title[i]}))},image_verify_event:function(e){var t="string"==typeof e?e:e.currentTarget.dataset.type||null;if(null!==t){var i=n.globalData.get_timestamp(),a=n.globalData.get_request_url("userverifyentry","user","","type="+t+"&t="+i);this.setData({verify_image_url:a})}},cache_refresh_event:function(t){n.globalData.init_config();var i=this;e.showLoading({title:"刷新中..."}),setTimeout((function(){i.init(),e.hideLoading()}),3e3)},plugins_thirdpartylogin_event:function(e){if(!this.agreement_status)return n.globalData.showToast("请先同意协议"),!1;e.currentTarget.dataset.type;var t=e.currentTarget.dataset.url||null;window.location.href=t},plugins_thirdpartylogin_cancel_event:function(t){e.redirectTo({url:"/pages/login/login"})}}};t.default=s}).call(this,i("543d")["default"])},a5d0:function(e,t,i){"use strict";var a=i("a845"),_=i.n(a);_.a},a845:function(e,t,i){},d4b4:function(e,t,i){"use strict";var a;i.d(t,"b",(function(){return _})),i.d(t,"c",(function(){return n})),i.d(t,"a",(function(){return a}));var _=function(){var e=this,t=e.$createElement,i=(e._self._c,null!=(e.home_site_logo_square||null)&&"login"==e.current_opt_form&&null!=(e.home_user_login_type||null)&&e.home_user_login_type.length>0?e.home_user_login_type.indexOf("username"):null),a=null!=(e.home_site_logo_square||null)&&"login"==e.current_opt_form&&null!=(e.home_user_login_type||null)&&e.home_user_login_type.length>0?e.home_user_login_type.indexOf("sms"):null,_=null!=(e.home_site_logo_square||null)&&"login"==e.current_opt_form&&null!=(e.home_user_login_type||null)&&e.home_user_login_type.length>0?e.home_user_login_type.indexOf("email"):null,n=null!=(e.home_site_logo_square||null)&&"login"!=e.current_opt_form&&"reg"==e.current_opt_form&&null!=(e.home_user_reg_type||null)&&e.home_user_reg_type.length>0?e.home_user_reg_type.indexOf("username"):null,r=null!=(e.home_site_logo_square||null)&&"login"!=e.current_opt_form&&"reg"==e.current_opt_form&&null!=(e.home_user_reg_type||null)&&e.home_user_reg_type.length>0?e.home_user_reg_type.indexOf("sms"):null,s=null!=(e.home_site_logo_square||null)&&"login"!=e.current_opt_form&&"reg"==e.current_opt_form&&null!=(e.home_user_reg_type||null)&&e.home_user_reg_type.length>0?e.home_user_reg_type.indexOf("email"):null;e.$mp.data=Object.assign({},{$root:{g0:i,g1:a,g2:_,g3:n,g4:r,g5:s}})},n=[]},db8e:function(e,t,i){"use strict";(function(e){i("7abb");a(i("66fd"));var t=a(i("0f1c"));function a(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=i,e(t.default)}).call(this,i("543d")["createPage"])}},[["db8e","common/runtime","common/vendor"]]]);