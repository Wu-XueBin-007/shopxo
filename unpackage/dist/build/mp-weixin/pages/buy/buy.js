(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/buy/buy"],{"2ed9":function(t,a,s){"use strict";(function(t){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var e=getApp(),n=function(){s.e("components/quick-nav/quick-nav").then(function(){return resolve(s("3783"))}.bind(null,s)).catch(s.oe)},i=function(){s.e("components/popup/popup").then(function(){return resolve(s("b1e3"))}.bind(null,s)).catch(s.oe)},o=function(){s.e("components/no-data/no-data").then(function(){return resolve(s("126b"))}.bind(null,s)).catch(s.oe)},_=e.globalData.get_static_url("common"),u={data:function(){return{common_static_url:_,data_list_loding_status:1,buy_submit_disabled_status:!1,data_list_loding_msg:"",params:null,payment_list:[],goods_list:[],address:null,address_id:null,total_price:0,user_note_value:"",user_note_status:!1,is_first:1,extension_data:[],payment_id:0,common_site_type:0,extraction_address:[],site_model:0,buy_header_nav:[{name:"快递邮寄",value:0},{name:"自提点取货",value:2}],currency_symbol:e.globalData.data.currency_symbol,common_order_is_booking:0,plugins_coupon_data:null,plugins_coupon_list:[],plugins_use_coupon_ids:[],plugins_choice_coupon_value:[],popup_plugins_coupon_status:!1,popup_plugins_coupon_index:null,plugins_points_data:null,plugins_points_status:!1}},components:{componentQuickNav:n,componentPopup:i,componentNoData:o},props:{},onLoad:function(a){null!=(a.data||null)&&e.globalData.get_length(JSON.parse(decodeURIComponent(a.data)))>0&&(this.setData({params:JSON.parse(decodeURIComponent(a.data))}),t.removeStorageSync(e.globalData.data.cache_buy_user_address_select_key))},onShow:function(){this.init(),this.setData({is_first:0}),this.init_config(),e.globalData.show_share_menu()},onPullDownRefresh:function(){this.init()},methods:{init_config:function(t){1==(t||!1)?this.setData({currency_symbol:e.globalData.get_config("currency_symbol"),common_order_is_booking:e.globalData.get_config("config.common_order_is_booking")}):e.globalData.is_config(this,"init_config")},init:function(){var a=this;if(null==this.params)return this.setData({data_list_loding_status:2,data_list_loding_msg:"订单信息有误"}),t.stopPullDownRefresh(),!1;if(0==this.is_first){var s=t.getStorageSync(e.globalData.data.cache_buy_user_address_select_key);null!=(s||null)&&this.setData({address:s,address_id:s.id})}t.showLoading({title:"加载中..."}),this.setData({data_list_loding_status:1});var n=this.params;n["address_id"]=this.address_id,n["payment_id"]=this.payment_id,n["site_model"]=this.site_model,t.request({url:e.globalData.get_request_url("index","buy"),method:"POST",data:this.request_data_ext_params_merge(n),dataType:"json",success:function(s){if(t.stopPullDownRefresh(),t.hideLoading(),0==s.data.code){var n=s.data.data;if(0==n.goods_list.length)a.setData({data_list_loding_status:0});else{if(a.setData({goods_list:n.goods_list,total_price:n.base.actual_price,extension_data:n.extension_data||[],data_list_loding_status:3,common_site_type:n.common_site_type||0,extraction_address:n.base.extraction_address||[],plugins_coupon_data:n.plugins_coupon_data||null,plugins_points_data:n.plugins_points_data||null}),null!=(n.plugins_coupon_data||null)){var i=[];for(var o in n.plugins_coupon_data){var _=n.plugins_coupon_data[o]["warehouse_id"];if(null!=(n.plugins_coupon_data[o]["coupon_data"]["coupon_choice"]||null))i[_]=n.plugins_coupon_data[o]["coupon_data"]["coupon_choice"]["coupon"]["desc"];else{var u=null!=(n.plugins_coupon_data[o]["coupon_data"]["coupon_list"]||null)?n.plugins_coupon_data[o]["coupon_data"].coupon_list.length:0;i[_]=u>0?"可选优惠劵"+u+"张":"暂无可用优惠劵"}}a.setData({plugins_choice_coupon_value:i})}a.setData({address:n.base.address||null,address_id:null!=(n.base.address||null)?n.base.address.id:null}),t.setStorage({key:e.globalData.data.cache_buy_user_address_select_key,data:n.base.address||null}),a.payment_list_data(n.payment_list)}}else a.setData({data_list_loding_status:2,data_list_loding_msg:s.data.msg}),e.globalData.is_login_check(s.data,a,"init")&&e.globalData.showToast(s.data.msg)},fail:function(){t.stopPullDownRefresh(),t.hideLoading(),a.setData({data_list_loding_status:2,data_list_loding_msg:"服务器请求出错"}),e.globalData.showToast("服务器请求出错")}})},request_data_ext_params_merge:function(t){var a=this.plugins_use_coupon_ids;if(null!=(a||null)&&a.length>0)for(var s in a)t["coupon_id_"+s]=a[s];return t["is_points"]=!0===this.plugins_points_status?1:0,t},bind_user_note_event:function(t){this.setData({user_note_value:t.detail.value})},bind_user_note_tap_event:function(t){this.setData({user_note_status:!0})},bind_user_note_blur_event:function(t){this.setData({user_note_status:!1})},buy_submit_event:function(a){var s=this,n=this.params;n["address_id"]=this.address_id,n["payment_id"]=this.payment_id,n["user_note"]=this.user_note_value,n["site_model"]=this.site_model;var i=[];0!=this.common_site_type&&2!=this.common_site_type&&4!=this.common_site_type||i.push({fields:"address_id",msg:"请选择地址",is_can_zero:1}),1!=this.common_order_is_booking&&i.push({fields:"payment_id",msg:"请选择支付方式"}),e.globalData.fields_check(n,i)&&(t.showLoading({title:"提交中..."}),this.setData({buy_submit_disabled_status:!0}),t.request({url:e.globalData.get_request_url("add","buy"),method:"POST",data:this.request_data_ext_params_merge(n),dataType:"json",success:function(a){t.hideLoading(),0==a.data.code?(1==a.data.data.order_status&&t.setStorageSync(e.globalData.data.cache_page_pay_key,a.data.data.order_ids.join(",")),t.redirectTo({url:"/pages/user-order/user-order"})):(e.globalData.showToast(a.data.msg),s.setData({buy_submit_disabled_status:!1}))},fail:function(){t.hideLoading(),s.setData({buy_submit_disabled_status:!1}),e.globalData.showToast("服务器请求出错")}}))},payment_event:function(t){this.setData({payment_id:t.currentTarget.dataset.value}),this.payment_list_data(this.payment_list),this.init()},payment_list_data:function(t){if(0!=this.payment_id)for(var a in t)t[a]["selected"]=t[a]["id"]==this.payment_id?"cr-main br-main":"";this.setData({payment_list:t||[]})},plugins_coupon_open_event:function(t){var a=t.currentTarget.dataset.index,s=this.plugins_coupon_data[a]["coupon_data"]["coupon_list"];if(s.length>0){var e=this.plugins_use_coupon_ids;for(var n in s)s[n]["is_active"]=-1!=e.indexOf(s[n]["id"])?1:0}this.setData({plugins_coupon_list:s,popup_plugins_coupon_status:!0,popup_plugins_coupon_index:a})},plugins_coupon_close_event:function(t){this.setData({popup_plugins_coupon_status:!1})},plugins_coupon_use_event:function(t){var a=t.currentTarget.dataset.index,s=t.currentTarget.dataset.value,e=this.plugins_use_coupon_ids;if(null!==this.popup_plugins_coupon_index&&-1==e.indexOf(s)){var n=this.plugins_coupon_data[this.popup_plugins_coupon_index],i=this.plugins_coupon_list;for(var o in i)i[o]["is_active"]=a==o?1:0;e[n["warehouse_id"]]=s,this.setData({plugins_use_coupon_ids:e,plugins_coupon_list:i,popup_plugins_coupon_status:!1}),this.init()}},plugins_coupon_not_use_event:function(t){if(null!==this.popup_plugins_coupon_index){var a=this.plugins_coupon_data[this.popup_plugins_coupon_index],s=this.plugins_coupon_list,e=this.plugins_use_coupon_ids;for(var n in s)s[n]["is_active"]=0;e[a["warehouse_id"]]=0,this.setData({plugins_coupon_list:s,plugins_use_coupon_ids:e,popup_plugins_coupon_status:!1}),this.init()}},address_event:function(a){0==this.common_site_type||4==this.common_site_type&&0==this.site_model?t.navigateTo({url:"/pages/user-address/user-address?is_back=1"}):2==this.common_site_type||4==this.common_site_type&&2==this.site_model?t.navigateTo({url:"/pages/extraction-address/extraction-address?is_back=1&is_buy=1"}):e.globalData.showToast("当前模式不允许使用地址")},buy_header_nav_event:function(a){var s=a.currentTarget.dataset.value||0;s!=this.site_model&&(this.setData({address:null,address_id:null,site_model:s}),t.removeStorageSync(e.globalData.data.cache_buy_user_address_select_key),this.init())},map_event:function(t){var a=t.currentTarget.dataset.index||0,s=this.goods_list[a]||null;if(null==s)return e.globalData.showToast("地址有误"),!1;var n=s.alias||s.name||"",i=(s.province_name||"")+(s.city_name||"")+(s.county_name||"")+(s.address||"");e.globalData.open_location(s.lng,s.lat,n,i)},points_event:function(t){this.setData({plugins_points_status:!this.plugins_points_status}),this.init()},warehouse_group_event:function(t){e.globalData.url_event(t)}}};a.default=u}).call(this,s("543d")["default"])},"38d2":function(t,a,s){},"6c89":function(t,a,s){"use strict";s.r(a);var e=s("8994"),n=s("e765");for(var i in n)"default"!==i&&function(t){s.d(a,t,(function(){return n[t]}))}(i);s("ddff");var o,_=s("f0c5"),u=Object(_["a"])(n["default"],e["b"],e["c"],!1,null,null,null,!1,e["a"],o);a["default"]=u.exports},8994:function(t,a,s){"use strict";var e;s.d(a,"b",(function(){return n})),s.d(a,"c",(function(){return i})),s.d(a,"a",(function(){return e}));var n=function(){var t=this,a=t.$createElement;t._self._c},i=[]},d53b:function(t,a,s){"use strict";(function(t){s("7abb");e(s("66fd"));var a=e(s("6c89"));function e(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=s,t(a.default)}).call(this,s("543d")["createPage"])},ddff:function(t,a,s){"use strict";var e=s("38d2"),n=s.n(e);n.a},e765:function(t,a,s){"use strict";s.r(a);var e=s("2ed9"),n=s.n(e);for(var i in e)"default"!==i&&function(t){s.d(a,t,(function(){return e[t]}))}(i);a["default"]=n.a}},[["d53b","common/runtime","common/vendor"]]]);