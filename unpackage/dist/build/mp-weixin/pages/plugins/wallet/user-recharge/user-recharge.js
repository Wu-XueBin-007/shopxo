(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/plugins/wallet/user-recharge/user-recharge"],{"0cba":function(a,t,e){"use strict";var n=e("b972"),s=e.n(n);s.a},"0d76":function(a,t,e){"use strict";(function(a){e("7abb");n(e("66fd"));var t=n(e("a895"));function n(a){return a&&a.__esModule?a:{default:a}}wx.__webpack_require_UNI_MP_PLUGIN__=e,a(t.default)}).call(this,e("543d")["createPage"])},"72d8":function(a,t,e){"use strict";e.r(t);var n=e("a64b"),s=e.n(n);for(var i in n)"default"!==i&&function(a){e.d(t,a,(function(){return n[a]}))}(i);t["default"]=s.a},"785e":function(a,t,e){"use strict";var n;e.d(t,"b",(function(){return s})),e.d(t,"c",(function(){return i})),e.d(t,"a",(function(){return n}));var s=function(){var a=this,t=a.$createElement;a._self._c},i=[]},a64b:function(a,t,e){"use strict";(function(a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;n(e("7d64"));function n(a){return a&&a.__esModule?a:{default:a}}var s=getApp(),i=function(){e.e("components/popup/popup").then(function(){return resolve(e("b1e3"))}.bind(null,e)).catch(e.oe)},o=function(){e.e("components/no-data/no-data").then(function(){return resolve(e("126b"))}.bind(null,e)).catch(e.oe)},l=function(){e.e("components/bottom-line/bottom-line").then(function(){return resolve(e("e5fd"))}.bind(null,e)).catch(e.oe)},_={data:function(){return{data_list:[],data_total:0,data_page_total:0,data_page:1,data_list_loding_status:1,data_bottom_line_status:!1,params:null,load_status:0,is_show_payment_popup:!1,payment_list:[],payment_id:0,temp_pay_value:0,temp_pay_index:0,nav_status_list:[{name:"全部",value:"-1"},{name:"待支付",value:"0"},{name:"已支付",value:"1"}],nav_status_index:0,content_list:[{name:"充值单号",field:"recharge_no"},{name:"充值金额",field:"money",unit:"元"},{name:"支付金额",field:"pay_money",unit:"元"}],popup_view_pay_qrcode_is_show:!1,popup_view_pay_data:null,popup_view_pay_timer:null}},components:{componentPopup:i,componentNoData:o,componentBottomLine:l},props:{},onLoad:function(a){var t=0;if(null!=(a.status||null))for(var e in this.nav_status_list)if(this.nav_status_list[e]["value"]==a.status){t=e;break}this.setData({params:a,nav_status_index:t}),this.init()},onShow:function(){s.globalData.show_share_menu()},onPullDownRefresh:function(){this.setData({data_page:1}),this.get_data_list(1)},methods:{init:function(){var t=s.globalData.get_user_info(this,"init");if(0!=t){if(s.globalData.user_is_need_login(t))return a.redirectTo({url:"/pages/login/login?event_callback=init"}),!1;this.get_data_list()}else this.setData({data_list_loding_status:0,data_bottom_line_status:!1})},get_data_list:function(t){var e=this;if(0==(t||0)&&1==this.data_bottom_line_status)return a.stopPullDownRefresh(),!1;a.showLoading({title:"加载中..."}),this.setData({data_list_loding_status:1});var n=null==(this.nav_status_list[this.nav_status_index]||null)?-1:this.nav_status_list[this.nav_status_index]["value"];a.request({url:s.globalData.get_request_url("index","recharge","wallet"),method:"POST",data:{page:this.data_page,status:n,is_more:1},dataType:"json",success:function(t){if(a.hideLoading(),a.stopPullDownRefresh(),0==t.data.code)if(t.data.data.data.length>0){if(e.data_page<=1){var n=t.data.data.data;if(0==e.load_status){var i=s.globalData.data.cache_page_pay_key,o=a.getStorageSync(i)||null;if(null!=o)for(var l in a.removeStorageSync(i),n)if(o==n[l]["id"]){e.setData({is_show_payment_popup:!0,temp_pay_value:n[l]["id"],temp_pay_index:l});break}}}else{n=e.data_list||[];var _=t.data.data.data;for(var l in _)n.push(_[l])}e.setData({data_list:n,data_total:t.data.data.total,data_page_total:t.data.data.page_total,data_list_loding_status:3,data_page:e.data_page+1,load_status:1,payment_list:t.data.data.payment_list||[]}),e.setData({data_bottom_line_status:e.data_page>1&&e.data_page>e.data_page_total})}else e.setData({data_list_loding_status:0,load_status:1,data_list:[],data_bottom_line_status:!1});else e.setData({data_list_loding_status:0,load_status:1}),s.globalData.is_login_check(t.data,e,"get_data_list")&&s.globalData.showToast(t.data.msg)},fail:function(){a.hideLoading(),a.stopPullDownRefresh(),e.setData({data_list_loding_status:2,load_status:1}),s.globalData.showToast("服务器请求出错")}})},scroll_lower:function(a){this.get_data_list()},pay_event:function(a){this.setData({is_show_payment_popup:!0,temp_pay_value:a.currentTarget.dataset.value,temp_pay_index:a.currentTarget.dataset.index})},payment_popup_event_close:function(a){this.setData({is_show_payment_popup:!1})},popup_payment_event:function(a){var t=a.currentTarget.dataset.value||0;this.setData({payment_id:t}),this.payment_popup_event_close(),this.pay_handle(this.temp_pay_value,this.temp_pay_index)},pay_handle:function(t,e){var n=this;a.showLoading({title:"请求中..."}),a.request({url:s.globalData.get_request_url("pay","recharge","wallet"),method:"POST",data:{recharge_id:t,payment_id:this.payment_id},dataType:"json",success:function(t){if(a.hideLoading(),0==t.data.code){var i=t.data.data;n.common_pay_handle(n,i,e)}else s.globalData.showToast(t.data.msg)},fail:function(){a.hideLoading(),s.globalData.showToast("服务器请求出错")}})},common_pay_handle:function(t,e,n){a.requestPayment({timeStamp:e.data.timeStamp,nonceStr:e.data.nonceStr,package:e.data.package,signType:e.data.signType,paySign:e.data.paySign,success:function(e){t.order_item_pay_success_handle(n),a.navigateTo({url:"/pages/paytips/paytips?code=9000"})},fail:function(a){s.globalData.showToast("支付失败")}})},qq_pay_handle:function(t,e,n){"Weixin"==e.payment.payment?a.requestWxPayment({url:e.data,referer:s.globalData.data.request_url,success:function(a){s.globalData.alert({msg:"支付成功后、请不要重复支付、如果订单状态未成功请联系客服处理",is_show_cancel:0}),t.get_data_list()},fail:function(a){s.globalData.showToast("支付失败")}}):t.common_pay_handle(t,e,n)},h5_pay_handle:function(t,e,n){if("string"==typeof e.data)window.location.href=e.data;else{var i=!1;if("Weixin"==e.payment.payment&&null!=(e.data.appId||null)&&null!=(e.data.timeStamp||null)&&null!=(e.data.nonceStr||null)&&null!=(e.data.package||null)&&null!=(e.data.signType||null)&&null!=(e.data.paySign||null)){var o=function(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.data.appId,timeStamp:e.data.timeStamp,nonceStr:e.data.nonceStr,package:e.data.package,signType:e.data.signType,paySign:e.data.paySign},(function(e){"get_brand_wcpay_request:ok"==e.err_msg&&(t.order_item_pay_success_handle(n),a.navigateTo({url:"/pages/paytips/paytips?code=9000"}))}))};i=!0,"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",o,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",o),document.attachEvent("onWeixinJSBridgeReady",o)):o()}if(null!=(e.data.qrcode_url||null)&&null!=(e.data.name||null)&&null!=(e.data.check_url||null)&&null!=(e.data.order_no||null)){i=!0,this.setData({popup_view_pay_data:e.data,popup_view_pay_qrcode_is_show:!0});var l=setInterval((function(){a.request({url:s.globalData.get_request_url("paycheck","recharge","wallet"),method:"POST",data:{order_no:t.popup_view_pay_data.order_no},dataType:"json",success:function(e){a.hideLoading(),0==e.data.code?(clearInterval(t.popup_view_pay_timer),t.setData({popup_view_pay_data:null,popup_view_pay_qrcode_is_show:!1}),t.order_item_pay_success_handle(n),a.navigateTo({url:"/pages/paytips/paytips?code=9000"})):-300!=e.data.code&&(clearInterval(t.popup_view_pay_timer),s.globalData.showToast(e.data.msg))},fail:function(){clearInterval(t.popup_view_pay_timer),s.globalData.showToast("服务器请求出错")}})}),3e3);t.setData({popup_view_pay_timer:l})}if(null!=(e.data.html||null)){i=!0;var _=document.createElement("paydivform");_.innerHTML=e.data.html,document.body.appendChild(_);var d=document.forms;d.length>0&&d[0].submit()}i||s.globalData.showToast(e.payment.name+"支付方式还未适配")}},order_item_pay_success_handle:function(a){var t=this.data_list;t[a]["pay_money"]=t[a]["money"],t[a]["status"]=1,t[a]["status_name"]="已支付",this.setData({data_list:t})},delete_event:function(t){var e=this;a.showModal({title:"温馨提示",content:"删除后不可恢复，确定继续吗?",confirmText:"确认",cancelText:"不了",success:function(n){if(n.confirm){var i=t.currentTarget.dataset.value,o=t.currentTarget.dataset.index;a.showLoading({title:"处理中..."}),a.request({url:s.globalData.get_request_url("delete","recharge","wallet"),method:"POST",data:{id:i},dataType:"json",success:function(t){if(a.hideLoading(),0==t.data.code){var n=e.data_list;n.splice(o,1),e.setData({data_list:n}),0==n.length&&e.setData({data_list_loding_status:0,data_bottom_line_status:!1}),s.globalData.showToast(t.data.msg,"success")}else s.globalData.showToast(t.data.msg)},fail:function(){a.hideLoading(),s.globalData.showToast("服务器请求出错")}})}}})},nav_event:function(a){this.setData({nav_status_index:a.currentTarget.dataset.index||0,data_page:1}),this.get_data_list(1)},popup_view_pay_qrcode_event_close:function(a){this.setData({popup_view_pay_qrcode_is_show:!1}),clearInterval(this.popup_view_pay_timer)},onUnload:function(a){clearInterval(this.popup_view_pay_timer)}}};t.default=_}).call(this,e("543d")["default"])},a895:function(a,t,e){"use strict";e.r(t);var n=e("785e"),s=e("72d8");for(var i in s)"default"!==i&&function(a){e.d(t,a,(function(){return s[a]}))}(i);e("0cba");var o,l=e("f0c5"),_=Object(l["a"])(s["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],o);t["default"]=_.exports},b972:function(a,t,e){}},[["0d76","common/runtime","common/vendor"]]]);