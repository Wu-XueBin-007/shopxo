(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/plugins/distribution/extraction-apply/extraction-apply"],{1003:function(t,a,e){"use strict";e.r(a);var i=e("1e10"),n=e("7baf");for(var o in n)"default"!==o&&function(t){e.d(a,t,(function(){return n[t]}))}(o);e("4e7e");var l,s=e("f0c5"),u=Object(s["a"])(n["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],l);a["default"]=u.exports},"1e10":function(t,a,e){"use strict";var i;e.d(a,"b",(function(){return n})),e.d(a,"c",(function(){return o})),e.d(a,"a",(function(){return i}));var n=function(){var t=this,a=t.$createElement;t._self._c},o=[]},"4e7e":function(t,a,e){"use strict";var i=e("6a0b"),n=e.n(i);n.a},"6a0b":function(t,a,e){},7917:function(t,a,e){"use strict";(function(t){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var e=getApp(),i=e.globalData.get_static_url("common"),n={data:function(){return{common_static_url:i,params:null,data_list_loding_status:1,data_list_loding_msg:"",extraction_data:{},province_list:[],city_list:[],county_list:[],province_id:null,city_id:null,county_id:null,editor_path_type:"",default_province:"请选择省",default_city:"请选择市",default_county:"请选择区/县",province_value:null,city_value:null,county_value:null,user_location_cache_key:e.globalData.data.cache_userlocation_key,user_location:null,form_submit_disabled_status:!1}},components:{},props:{},onLoad:function(t){this.setData({params:t})},onReady:function(){t.removeStorage({key:this.user_location_cache_key}),this.init()},onShow:function(){this.user_location_init(),e.globalData.show_share_menu()},methods:{init:function(){var a=e.globalData.get_user_info(this,"init");if(0!=a){if(e.globalData.user_is_need_login(a))return t.redirectTo({url:"/pages/login/login?event_callback=init"}),this.setData({data_list_loding_status:2,data_list_loding_msg:"请先绑定手机号码"}),!1;this.get_province_list(),this.applyinfo_init()}else this.setData({data_list_loding_status:2,data_list_loding_msg:"请先授权用户信息"})},applyinfo_init:function(){var a=this;t.request({url:e.globalData.get_request_url("applyinfo","extraction","distribution"),method:"POST",data:{},dataType:"json",success:function(t){if(0==t.data.code){var i=t.data.data,n=i.extraction_data||null;if(a.setData({extraction_data:n||{},editor_path_type:i.editor_path_type||""}),null!=n){a.setData({province_id:n.province||null,city_id:n.city||null,county_id:n.county||null});var o=n.lng||0,l=n.lat||0;0!=o&&0!=l&&a.setData({user_location:{lng:o,lat:l,address:n.address||""}})}a.get_city_list(),a.get_county_list(),setTimeout((function(){a.init_region_value()}),500)}else e.globalData.is_login_check(t.data)&&e.globalData.showToast(t.data.msg)},fail:function(){e.globalData.showToast("省份信息失败")}})},init_region_value:function(){this.setData({province_value:this.get_region_value("province_list","province_id"),city_value:this.get_region_value("city_list","city_id"),county_value:this.get_region_value("county_list","county_id")})},get_region_value:function(t,a){var e=this[t],i=this[a],n=null;return e.forEach((function(t,a){if(t.id==i)return n=a,!1})),n},get_province_list:function(){var a=this;t.request({url:e.globalData.get_request_url("index","region"),method:"POST",data:{},dataType:"json",success:function(t){if(0==t.data.code){var i=t.data.data;a.setData({province_list:i})}else e.globalData.showToast(t.data.msg)},fail:function(){e.globalData.showToast("省份获取失败")}})},get_city_list:function(){var a=this;a.province_id&&t.request({url:e.globalData.get_request_url("index","region"),method:"POST",data:{pid:a.province_id},dataType:"json",success:function(t){if(0==t.data.code){var i=t.data.data;a.setData({city_list:i})}else e.globalData.showToast(t.data.msg)},fail:function(){e.globalData.showToast("城市获取失败")}})},get_county_list:function(){var a=this;a.city_id&&t.request({url:e.globalData.get_request_url("index","region"),method:"POST",data:{pid:a.city_id},dataType:"json",success:function(t){if(0==t.data.code){var i=t.data.data;a.setData({county_list:i})}else e.globalData.showToast(t.data.msg)},fail:function(){e.globalData.showToast("区/县获取失败")}})},select_province_event:function(t){var a=t.detail.value||0;if(a>=0){var e=this.province_list[a];this.setData({province_value:a,province_id:e.id,city_value:null,county_value:null,city_id:null,county_id:null}),this.get_city_list()}},select_city_event:function(t){var a=t.detail.value||0;if(a>=0){var e=this.city_list[a];this.setData({city_value:a,city_id:e.id,county_value:null,county_id:null}),this.get_county_list()}},select_county_event:function(t){var a=t.detail.value||0;if(a>=0){var e=this.county_list[a];this.setData({county_value:a,county_id:e.id})}},region_select_error_event:function(t){var a=t.currentTarget.dataset.value||null;null!=a&&e.globalData.showToast(a)},choose_location_event:function(a){t.navigateTo({url:"/pages/common/open-setting-location/open-setting-location"})},user_location_init:function(){var a=t.getStorageSync(this.user_location_cache_key)||null,e=null;null!=a&&(e={name:a.name||null,address:a.address||null,lat:a.latitude||null,lng:a.longitude||null}),this.setData({user_location:e})},form_submit:function(a){var i=this,n=a.detail.value,o=[{fields:"name",msg:"请填写联系人"},{fields:"tel",msg:"请填写联系电话"},{fields:"province",msg:"请选择省份"},{fields:"city",msg:"请选择城市"},{fields:"county",msg:"请选择区县"},{fields:"address",msg:"请填写详细地址"},{fields:"lng",msg:"请选择地理位置"},{fields:"lat",msg:"请选择地理位置"}];n["logo"]=null!=(this.extraction_data||null)&&this.extraction_data.logo||"",n["province"]=i.province_id,n["city"]=i.city_id,n["county"]=i.county_id;var l=0,s=0;null!=(i.user_location||null)&&(l=i.user_location.lng||0,s=i.user_location.lat||0),null!=(i.extraction_data||null)&&(null==(l||null)&&(l=i.extraction_data.lng||0),null==(s||null)&&(s=i.extraction_data.lat||0)),n["lng"]=l,n["lat"]=s,e.globalData.fields_check(n,o)&&(null!=(i.extraction_data||null)&&1==(i.extraction_data.status||0)?t.showModal({title:"温馨提示",content:"数据需重新审核后方可生效",confirmText:"确认",cancelText:"暂不",success:function(t){t.confirm&&i.request_data_save(n)}}):i.request_data_save(n))},request_data_save:function(a){var i=this;i.setData({form_submit_disabled_status:!0}),t.showLoading({title:"处理中..."}),t.request({url:e.globalData.get_request_url("applysave","extraction","distribution"),method:"POST",data:a,dataType:"json",success:function(a){t.hideLoading(),0==a.data.code?(e.globalData.showToast(a.data.msg,"success"),setTimeout((function(){t.navigateBack()}),1e3)):(i.setData({form_submit_disabled_status:!1}),e.globalData.is_login_check(a.data)?e.globalData.showToast(a.data.msg):e.globalData.showToast("提交失败，请重试！"))},fail:function(){i.setData({form_submit_disabled_status:!1}),t.hideLoading(),e.globalData.showToast("服务器请求出错")}})},upload_show_event:function(a){t.previewImage({current:this.extraction_data.logo,urls:[this.extraction_data.logo]})},upload_delete_event:function(a){var e=this;t.showModal({title:"温馨提示",content:"删除后不可恢复、继续吗？",success:function(t){if(t.confirm){var a=e.extraction_data||{};a["logo"]="",e.setData({extraction_data:a})}}})},file_upload_event:function(a){var e=this;t.chooseImage({count:1,success:function(t){var a=0,i=0,n=t.tempFilePaths.length,o=0;e.upload_one_by_one(t.tempFilePaths,a,i,o,n)}})},upload_one_by_one:function(a,i,n,o,l){var s=this;t.uploadFile({url:e.globalData.get_request_url("index","ueditor"),filePath:a[o],name:"upfile",formData:{action:"uploadimage",path_type:s.editor_path_type},success:function(t){if(i++,200==t.statusCode){var a="object"==typeof t.data?t.data:JSON.parse(t.data);if(0==a.code&&null!=(a.data.url||null)){var n=s.extraction_data||{};n["logo"]=a.data.url,s.setData({extraction_data:n})}else e.globalData.showToast(a.msg)}},fail:function(t){n++},complete:function(t){o++,o>=l||s.upload_one_by_one(a,i,n,o,l)}})}}};a.default=n}).call(this,e("543d")["default"])},"7baf":function(t,a,e){"use strict";e.r(a);var i=e("7917"),n=e.n(i);for(var o in i)"default"!==o&&function(t){e.d(a,t,(function(){return i[t]}))}(o);a["default"]=n.a},b68c:function(t,a,e){"use strict";(function(t){e("7abb");i(e("66fd"));var a=i(e("1003"));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=e,t(a.default)}).call(this,e("543d")["createPage"])}},[["b68c","common/runtime","common/vendor"]]]);