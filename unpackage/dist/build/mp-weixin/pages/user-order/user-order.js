(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user-order/user-order"],{"5ee2":function(a,t,e){"use strict";(function(a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;s(e("7d64"));function s(a){return a&&a.__esModule?a:{default:a}}var n=getApp(),o=function(){e.e("components/popup/popup").then(function(){return resolve(e("b1e3"))}.bind(null,e)).catch(e.oe)},i=function(){e.e("components/no-data/no-data").then(function(){return resolve(e("126b"))}.bind(null,e)).catch(e.oe)},l=function(){e.e("components/bottom-line/bottom-line").then(function(){return resolve(e("e5fd"))}.bind(null,e)).catch(e.oe)},_=n.globalData.get_static_url("common"),d={data:function(){return{common_static_url:_,data_list:[],data_total:0,data_page_total:0,data_page:1,data_list_loding_status:1,data_bottom_line_status:!1,params:null,input_keyword_value:"",load_status:0,is_show_payment_popup:!1,payment_list:[],payment_id:0,payment_type:"",temp_pay_value:"",nav_status_list:[{name:"全部",value:"-1"},{name:"待付款",value:"1"},{name:"待发货",value:"2"},{name:"待收货",value:"3"},{name:"已完成",value:"4"},{name:"已失效",value:"5,6"}],nav_status_index:0,order_select_ids:[],popup_view_pay_html_is_show:!1,popup_view_pay_qrcode_is_show:!1,popup_view_pay_data:null,popup_view_pay_timer:null,home_is_enable_order_bulk_pay:0}},components:{componentPopup:o,componentNoData:i,componentBottomLine:l},props:{},onLoad:function(a){var t=0;if(null!=(a.status||null))for(var e in this.nav_status_list)if(this.nav_status_list[e]["value"]==a.status){t=e;break}this.setData({params:a,nav_status_index:t})},onShow:function(){this.init(),this.init_config(),n.globalData.show_share_menu()},onPullDownRefresh:function(){this.setData({data_page:1}),this.get_data_list(1)},methods:{init_config:function(a){1==(a||!1)?this.setData({home_is_enable_order_bulk_pay:n.globalData.get_config("config.home_is_enable_order_bulk_pay")}):n.globalData.is_config(this,"init_config")},init:function(){var t=n.globalData.get_user_info(this,"init");if(0!=t){if(n.globalData.user_is_need_login(t))return a.redirectTo({url:"/pages/login/login?event_callback=init"}),!1;this.get_data_list()}else this.setData({data_list_loding_status:0,data_bottom_line_status:!1})},input_event:function(a){this.setData({input_keyword_value:a.detail.value})},get_data_list:function(t){var e=this;if(0==(t||0)&&1==this.data_bottom_line_status)return a.stopPullDownRefresh(),!1;a.showLoading({title:"加载中..."}),this.setData({data_list_loding_status:1});var s=null==(this.nav_status_list[this.nav_status_index]||null)?-1:this.nav_status_list[this.nav_status_index]["value"];a.request({url:n.globalData.get_request_url("index","order"),method:"POST",data:{page:this.data_page,keywords:this.input_keyword_value||"",status:s,is_more:1},dataType:"json",success:function(t){if(a.hideLoading(),a.stopPullDownRefresh(),0==t.data.code)if(t.data.data.data.length>0){if(e.data_page<=1){var s=t.data.data.data;if(0==e.load_status){var o=n.globalData.data.cache_page_pay_key,i=a.getStorageSync(o)||null;null!=i&&(a.removeStorageSync(o),e.pay_handle(i))}}else{s=e.data_list||[];var l=t.data.data.data;for(var _ in l)s.push(l[_])}e.setData({data_list:s,data_total:t.data.data.total,data_page_total:t.data.data.page_total,data_list_loding_status:3,data_page:e.data_page+1,load_status:1,payment_list:t.data.data.payment_list||[]}),e.setData({data_bottom_line_status:e.data_page>1&&e.data_page>e.data_page_total})}else e.setData({data_list_loding_status:0,load_status:1,data_list:[],data_bottom_line_status:!1});else e.setData({data_list_loding_status:0,load_status:1}),n.globalData.is_login_check(t.data,e,"get_data_list")&&n.globalData.showToast(t.data.msg)},fail:function(){a.hideLoading(),a.stopPullDownRefresh(),e.setData({data_list_loding_status:2,load_status:1}),n.globalData.showToast("服务器请求出错")}})},scroll_lower:function(a){this.get_data_list()},pay_event:function(a){this.setData({is_show_payment_popup:!0,temp_pay_value:a.currentTarget.dataset.value,order_select_ids:[]})},payment_popup_event_close:function(a){this.setData({is_show_payment_popup:!1})},popup_payment_event:function(a){var t=a.currentTarget.dataset.value||0,e=a.currentTarget.dataset.type||"";this.setData({payment_id:t,payment_type:e}),this.payment_popup_event_close(),this.pay_handle(this.temp_pay_value)},pay_handle:function(t){var e=this;a.showLoading({title:"请求中..."}),a.request({url:n.globalData.get_request_url("pay","order"),method:"POST",data:{ids:t,payment_id:this.payment_id},dataType:"json",success:function(s){if(a.hideLoading(),0==s.data.code)if(1==(s.data.data.is_success||0))e.order_item_pay_success_handle(t),n.globalData.showToast("支付成功","success");else switch(s.data.data.is_payment_type){case 0:var o=s.data.data;e.common_pay_handle(e,o,t);break;case 1:var i=t.split(","),l=e.data_list;for(var _ in l)-1!=i.indexOf(l[_]["id"])&&(l[_]["is_under_line"]=1);e.setData({data_list:l}),n.globalData.alert({msg:s.data.msg,is_show_cancel:0});break;case 2:e.order_item_pay_success_handle(t),n.globalData.showToast("支付成功","success");break;default:n.globalData.showToast("支付类型有误")}else-6666==s.data.code&&null!=(s.data.data||null)?e.setData({popup_view_pay_data:s.data.data,popup_view_pay_html_is_show:!0}):n.globalData.showToast(s.data.msg)},fail:function(){a.hideLoading(),n.globalData.showToast("服务器请求出错")}})},common_pay_handle:function(t,e,s){a.requestPayment({timeStamp:e.data.timeStamp,nonceStr:e.data.nonceStr,package:e.data.package,signType:e.data.signType,paySign:e.data.paySign,success:function(e){t.order_item_pay_success_handle(s),a.navigateTo({url:"/pages/paytips/paytips?code=9000"})},fail:function(a){n.globalData.showToast("支付失败")}})},qq_pay_handle:function(t,e,s){"Weixin"==e.payment.payment?a.requestWxPayment({url:e.data,referer:n.globalData.data.request_url,success:function(a){n.globalData.alert({msg:"支付成功后、请不要重复支付、如果订单状态未成功请联系客服处理",is_show_cancel:0}),t.get_data_list()},fail:function(a){n.globalData.showToast("支付失败")}}):t.common_pay_handle(t,e,s)},h5_pay_handle:function(t,e,s){if("string"==typeof e.data)window.location.href=e.data;else{var o=!1;if("Weixin"==e.payment.payment&&null!=(e.data.appId||null)&&null!=(e.data.timeStamp||null)&&null!=(e.data.nonceStr||null)&&null!=(e.data.package||null)&&null!=(e.data.signType||null)&&null!=(e.data.paySign||null)){var i=function(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.data.appId,timeStamp:e.data.timeStamp,nonceStr:e.data.nonceStr,package:e.data.package,signType:e.data.signType,paySign:e.data.paySign},(function(e){"get_brand_wcpay_request:ok"==e.err_msg&&(t.order_item_pay_success_handle(s),a.navigateTo({url:"/pages/paytips/paytips?code=9000"}))}))};o=!0,"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",i,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",i),document.attachEvent("onWeixinJSBridgeReady",i)):i()}if(null!=(e.data.qrcode_url||null)&&null!=(e.data.name||null)&&null!=(e.data.check_url||null)&&null!=(e.data.order_no||null)){o=!0,this.setData({popup_view_pay_data:e.data,popup_view_pay_qrcode_is_show:!0});var l=setInterval((function(){a.request({url:n.globalData.get_request_url("paycheck","order"),method:"POST",data:{order_no:t.popup_view_pay_data.order_no},dataType:"json",success:function(e){a.hideLoading(),0==e.data.code?(clearInterval(t.popup_view_pay_timer),t.setData({popup_view_pay_data:null,popup_view_pay_qrcode_is_show:!1}),t.order_item_pay_success_handle(s),a.navigateTo({url:"/pages/paytips/paytips?code=9000"})):-300!=e.data.code&&(clearInterval(t.popup_view_pay_timer),n.globalData.showToast(e.data.msg))},fail:function(){clearInterval(t.popup_view_pay_timer),n.globalData.showToast("服务器请求出错")}})}),3e3);t.setData({popup_view_pay_timer:l})}if(null!=(e.data.html||null)){o=!0;var _=document.createElement("paydivform");_.innerHTML=e.data.html,document.body.appendChild(_);var d=document.forms;d.length>0&&d[0].submit()}o||n.globalData.showToast(e.payment.name+"支付方式还未适配")}},order_item_pay_success_handle:function(a){var t=a.split(","),e=this.data_list;for(var s in e)if(-1!=t.indexOf(e[s]["id"]))switch(e[s]["operate_data"]["is_pay"]=0,e[s]["operate_data"]["is_cancel"]=0,parseInt(e[s]["order_model"])){case 0:e[s]["status"]=2,e[s]["status_name"]="待发货";break;case 2:e[s]["status"]=2,e[s]["status_name"]="待取货";break;case 3:e[s]["status"]=3,e[s]["status_name"]="待收货";break}this.setData({data_list:e})},cancel_event:function(t){var e=this;a.showModal({title:"温馨提示",content:"取消后不可恢复，确定继续吗?",confirmText:"确认",cancelText:"不了",success:function(s){if(s.confirm){var o=t.currentTarget.dataset.value,i=t.currentTarget.dataset.index;a.showLoading({title:"处理中..."}),a.request({url:n.globalData.get_request_url("cancel","order"),method:"POST",data:{id:o},dataType:"json",success:function(t){if(a.hideLoading(),0==t.data.code){var s=e.data_list;s[i]["status"]=5,s[i]["status_name"]="已取消",s[i]["operate_data"]["is_cancel"]=0,s[i]["operate_data"]["is_delete"]=1,s[i]["is_can_launch_aftersale"]=0,e.setData({data_list:s}),n.globalData.showToast(t.data.msg,"success")}else n.globalData.showToast(t.data.msg)},fail:function(){a.hideLoading(),n.globalData.showToast("服务器请求出错")}})}}})},collect_event:function(t){var e=this;a.showModal({title:"温馨提示",content:"请确认已收到货物或已完成，操作后不可恢复，确定继续吗?",confirmText:"确认",cancelText:"不了",success:function(s){if(s.confirm){var o=t.currentTarget.dataset.value,i=t.currentTarget.dataset.index;a.showLoading({title:"处理中..."}),a.request({url:n.globalData.get_request_url("collect","order"),method:"POST",data:{id:o},dataType:"json",success:function(t){if(a.hideLoading(),0==t.data.code){var s=e.data_list;s[i]["status"]=4,s[i]["status_name"]="已完成",s[i]["operate_data"]["is_collect"]=0,s[i]["operate_data"]["is_comments"]=1,s[i]["operate_data"]["is_delete"]=1,e.setData({data_list:s}),n.globalData.showToast(t.data.msg,"success")}else n.globalData.showToast(t.data.msg)},fail:function(){a.hideLoading(),n.globalData.showToast("服务器请求出错")}})}}})},delete_event:function(t){var e=this;a.showModal({title:"温馨提示",content:"删除后不可恢复，确定继续吗?",confirmText:"确认",cancelText:"不了",success:function(s){if(s.confirm){var o=t.currentTarget.dataset.value,i=t.currentTarget.dataset.index;a.showLoading({title:"处理中..."}),a.request({url:n.globalData.get_request_url("delete","order"),method:"POST",data:{id:o},dataType:"json",success:function(t){if(a.hideLoading(),0==t.data.code){var s=e.data_list;s.splice(i,1);var o=s.length;e.setData({data_list:s,data_list_loding_status:0==o?0:3,data_bottom_line_status:0!=o&&e.data_bottom_line_status}),n.globalData.showToast(t.data.msg,"success")}else n.globalData.showToast(t.data.msg)},fail:function(){a.hideLoading(),n.globalData.showToast("服务器请求出错")}})}}})},rush_event:function(a){n.globalData.showToast("催促成功","success")},nav_event:function(a){this.setData({nav_status_index:a.currentTarget.dataset.index||0,data_page:1,order_select_ids:[]}),this.get_data_list(1)},orderaftersale_event:function(t){var e=t.currentTarget.dataset.oid||0,s=t.currentTarget.dataset.did||0;if(0==e||0==s)return n.globalData.showToast("参数有误"),!1;a.navigateTo({url:"/pages/user-orderaftersale-detail/user-orderaftersale-detail?oid="+e+"&did="+s})},comments_event:function(t){a.navigateTo({url:"/pages/user-order-comments/user-order-comments?id="+t.currentTarget.dataset.value})},selected_event:function(a){var t=a.currentTarget.dataset.oid||0,e=this.order_select_ids;if(-1==e.indexOf(t))e.push(t);else for(var s in e)e[s]==t&&e.splice(s,1);this.setData({order_select_ids:e})},pay_merge_event:function(a){this.setData({is_show_payment_popup:!0,temp_pay_value:this.order_select_ids.join(",")})},url_event:function(a){n.globalData.url_event(a)},popup_view_pay_qrcode_event_close:function(a){this.setData({popup_view_pay_qrcode_is_show:!1}),clearInterval(this.popup_view_pay_timer)},popup_view_pay_html_event_close:function(a){this.setData({popup_view_pay_html_is_show:!1})},onUnload:function(a){clearInterval(this.popup_view_pay_timer)}}};t.default=d}).call(this,e("543d")["default"])},"77ec":function(a,t,e){"use strict";e.d(t,"b",(function(){return n})),e.d(t,"c",(function(){return o})),e.d(t,"a",(function(){return s}));var s={mpHtml:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/mp-html/components/mp-html/mp-html")]).then(e.bind(null,"43bcf"))}},n=function(){var a=this,t=a.$createElement,e=(a._self._c,a.data_list.length>0?a.__map(a.data_list,(function(t,e){var s=a.__get_orig(t),n=1==a.nav_status_index&&1==a.home_is_enable_order_bulk_pay?a.order_select_ids.indexOf(t.id):null;return{$orig:s,g0:n}})):null);a.$mp.data=Object.assign({},{$root:{l0:e}})},o=[]},"92d9":function(a,t,e){"use strict";e.r(t);var s=e("5ee2"),n=e.n(s);for(var o in s)"default"!==o&&function(a){e.d(t,a,(function(){return s[a]}))}(o);t["default"]=n.a},9354:function(a,t,e){"use strict";var s=e("9a65"),n=e.n(s);n.a},"9a65":function(a,t,e){},b3e1:function(a,t,e){"use strict";e.r(t);var s=e("77ec"),n=e("92d9");for(var o in n)"default"!==o&&function(a){e.d(t,a,(function(){return n[a]}))}(o);e("9354");var i,l=e("f0c5"),_=Object(l["a"])(n["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],i);t["default"]=_.exports},e189:function(a,t,e){"use strict";(function(a){e("7abb");s(e("66fd"));var t=s(e("b3e1"));function s(a){return a&&a.__esModule?a:{default:a}}wx.__webpack_require_UNI_MP_PLUGIN__=e,a(t.default)}).call(this,e("543d")["createPage"])}},[["e189","common/runtime","common/vendor"]]]);